# Session Notes â€” 2025-09-17 12:15

## What changed
- Implemented secure auth service in `mcp/index-http.js` with JWT, bcrypt, and PostgreSQL (via `pg`).
  - Endpoints: `/auth/dev-bootstrap` (bootstrap developer with header token), `/auth/login`, `/auth/me`, `/admin/users`, `/admin/user` (create/update), `/admin/user/:id` (delete).
  - CORS headers with configurable `ALLOWED_ORIGIN`.
  - DB migration for `users` table on startup.
- Frontend login and developer admin UI in `apps/vplm-portal`:
  - `AuthProvider` context, `LoginPage`, route guards, nav Sign In/Out, and Developer tab.
  - `AdminPage` for managing a whitelist (phones/passwords/roles).
- Added dependencies: `bcryptjs`, `jsonwebtoken`, `pg` to `mcp` package.

## Why
- Secure the public site with user/password login using phone numbers as usernames.
- Provide a developer-only admin tab to manage employee logins.

## Files touched
- Modified: `mcp/index-http.js`, `mcp/package.json`, `apps/vplm-portal/src/app.tsx`, `apps/vplm-portal/src/main.tsx`
- Added: `apps/vplm-portal/src/lib/api.ts`, `apps/vplm-portal/src/lib/auth.tsx`, `apps/vplm-portal/src/routes/login.tsx`, `apps/vplm-portal/src/routes/admin.tsx`

## Validation/Build steps
- Installed new server deps and ran local `npm run build` (frontend) successfully.
- Auth requires `DATABASE_URL` and `JWT_SECRET` at runtime; without DB, endpoints return 503.

## Follow-ups
- Configure Render env vars: `DATABASE_URL`, `JWT_SECRET`, `ALLOWED_ORIGIN`.
- Create Render PostgreSQL and set `DATABASE_URL` accordingly (Render provides ssl).
- Set a one-time `DEV_BOOTSTRAP_TOKEN`, then call `/auth/dev-bootstrap` to create your developer account.
- After bootstrap, sign in from `/login` and manage users in `/admin`.

